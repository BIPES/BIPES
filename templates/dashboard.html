<!doctype html>

<head>
	<title>{{ app_name }}</title>
  <meta name="viewport" content="width=device-width, user-scalable=no">
	<link rel="stylesheet" href='/static/style/main.css' />
{% for key, plugin in npm.items() %}
  {% if plugin.import %}
	  <script type="text/javascript" src="{{ plugin.src }}"></script>
    {% if plugin.css_src %}
  	<link rel="stylesheet" href='{{ plugin.css_src }}' />
    {% endif %}
  {% endif %}
{% endfor %}
{% for item in navigation %}
  {% if item.css_src %}
	<link rel="stylesheet" href='/static/style/{{ item.css_src }}.css' />
  {% endif %}
{% endfor %}
</head>


<body>

<nav>
<div id="panels">
	<span id="menu"></span>
{% for item in navigation %}
	<a id="{{ item.href }}" href="/dashboard?{{ item.href }}">{{ item.caption }}</a>
{% endfor %}
</div>
<div>
  <div id="app-version">Version {{ app_version }}</div>
	<a id="logout" href='/logout'>Exit</a>
</div>
</nav>

{% for item in navigation %}
<section id="{{ item.href }}"></section>
{% endfor %}
 

<script>
    var modules = {},
        navigation,
        storage,
        command,
        channel

</script>
<script type="module">
    import {Navigation, interpretLink} from './static/base/navigation.js'
    import {CommandBroker} from './static/base/command.js'
    import {StorageBroker} from './static/base/storage.js'
    import {Channel} from './static/base/channel.js'
{% for item in navigation %}
    import { {{item.js_class}} } from './static/modules/{{item.href}}.js'
{% endfor %}
  // Init CommandBroker, StorageBroker and Channel with modules as root object
  command = new CommandBroker(modules)
  storage = new StorageBroker(modules)
  channel = new Channel(modules)

{% for item in navigation %}
    modules.{{item.href}} = new {{item.js_class}}
{% endfor %}

  navigation = new Navigation(modules)

  interpretLink(false)

</script>

</body>
