<!doctype html>

<head>
  <title>{{ app_name }}</title>
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <link rel="icon" sizes="192x192" href="static/media/icon/icon-192x192.png">
  <link rel="stylesheet" href='/static/style/main.css' />
{% for key, plugin in npm.items() %}
  {% if plugin.import %}
    <script type="text/javascript" src="{{ plugin.src }}"></script>
    {% if plugin.css_src %}
    <link rel="stylesheet" href='{{ plugin.css_src }}' />
    {% endif %}
  {% endif %}
{% endfor %}
{% for item in navigation %}
  {% if item.css_src %}
  <link rel="stylesheet" href='/static/style/{{ item.css_src }}.css' />
  {% endif %}
{% endfor %}
</head>


<body>

<nav>
<div id="panels">
  <span id="menu">{{ app_name }}</span>
{% for item in navigation %}
  <a id="{{ item.href }}" href="/ide?{{ item.href }}">{{ item.caption }}</a>
{% endfor %}
</div>
<div id="extra">
  <div id="app-version">Version {{ app_version }}</div>
</div>
</nav>

{% for item in navigation %}
<section id="{{ item.href }}"></section>
{% endfor %}

<script>
    var page = {},
        navigation,
        storage,
        command,
        channel,
        rosetta

</script>
<script type="module">
    import {Navigation, interpretLink} from './static/base/navigation.js'
    import {CommandBroker} from './static/base/command.js'
    import {StorageBroker} from './static/base/storage.js'
    import {Channel} from './static/base/channel.js'
    import {Rosetta} from './static/base/rosetta.js'

{% for item in navigation %}
    import { {{item.js_class}} } from './static/pages/{{item.href}}.js'
{% endfor %}
  // Init CommandBroker, StorageBroker and Channel with page as root object
  command = new CommandBroker(page)
  storage = new StorageBroker(page)
  channel = new Channel(page)
  rosetta = Rosetta.set('MicroPython')

{% for item in navigation %}
    page.{{item.href}} = new {{item.js_class}}
{% endfor %}

  navigation = new Navigation(page)

  interpretLink(false)

</script>

</body>
